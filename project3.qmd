---
title: "project3"
---

Who is doing what research question:

Tiannah - During which time period did hospitalizations peak and how have recovery rates changed over time?

Ruixin - Which countries had the highest cumulative deaths?

Ethan - What is the relationship between positivity and testing rates across different regions and how does this relationship change throughout phases of the pandemic

Ashley - How do hospitalization rates compare across time and across countries?

Kevin - Is there a relationship between hospitalization lag with identification of positive COVID cases, and how does this lag correlate with healthcare infrastructure of a given region

? - To what extent does geolocation contribute to the trajectories of COVID cases in a specific region. Do neighboring countries exhibit similar trends and what factors contribute to these patterns.

? - Make slides, 1 for each question

```{r}
library(ggplot2)
library(plotly)
library(dplyr)

covid_data <- read.csv("tested_worldwide.csv") %>% 
  mutate(Date = as.Date(Date, format = "%Y-%m-%d"))
```

```{r}
daily_positive_tested <- covid_data %>%  
  group_by(Country_Region) %>% 
  summarize(
    avg_positive = mean(daily_positive, na.rm = TRUE),
    avg_tested = mean(daily_tested, na.rm = TRUE),
    positive_rate = avg_positive/avg_tested
  )

positive_tested_chart <- ggplot(
  daily_positive_tested %>%
    filter(
      !is.na(avg_positive) & !is.na(avg_tested) & !is.na(positive_rate),
      avg_positive > 0,
      avg_tested > 0,
      positive_rate > 0
    ),
  mapping = aes(
    x = avg_positive,
    y = avg_tested,
    size = positive_rate,
    color = positive_rate,
    text = paste("Country:", Country_Region)
  )) +
  geom_point() +
  scale_x_log10() +
  scale_y_log10() +
  labs(
    title = "Average Daily Positive Cases vs Quantity of Testing",
    x = "Average Daily Positive Cases",
    y = "Average Daily Quantity of Tests",
    color = "positivity rate"
  ) +
  theme_minimal()

positive_tested_interactive <- ggplotly(positive_tested_chart)
positive_tested_interactive
```

# Q2: How do hospitalization rates compare across time and across countries?
library(shiny)
library(plotly)
library(dplyr)
library(readr)

hospital_data <- read_csv("tested_worldwide.csv") %>%
  mutate(
    Date = as.Date(Date),
    hospitalizedCurr = as.numeric(hospitalizedCurr))

hospital_data <- hospital_data %>% filter(!is.na(hospitalizedCurr))

ui <- fluidPage(
  titlePanel("Current Hospitalizations Across Countries"),
  sidebarLayout(
    sidebarPanel(
      selectInput("country", "Select country:",
                  choices = unique(hospital_data$Country_Region),
                  selected = unique(hospital_data$Country_Region),
                  multiple = TRUE),
      dateRangeInput("date_range", "Select date range:",
                     start = min(hospital_data$Date),
                     end = max(hospital_data$Date))
    ),
    mainPanel(
      plotlyOutput("hospital_plot")
    )))

server <- function(input, output) {
  filtered_data <- reactive({
    hospital_data %>%
      filter(Country_Region %in% input$country,
             Date >= input$date_range[1],
             Date <= input$date_range[2]) %>%
      group_by(Date, Country_Region) %>%
      summarise(current_hospitalized = sum(hospitalizedCurr, na.rm = TRUE), .groups = "drop")
  })
  
  output$hospital_plot <- renderPlotly({
    plot_ly(filtered_data(), x = ~Date, y = ~current_hospitalized, color = ~Country_Region,
            type = 'scatter', mode = 'lines+markers') %>%
      layout(title = "Currently Hospitalized Patients Over Time",
             xaxis = list(title = "Date"),
             yaxis = list(title = "Currently Hospitalized"),
             hovermode = "compare")
  })
}

shinyApp(ui = ui, server = server)
